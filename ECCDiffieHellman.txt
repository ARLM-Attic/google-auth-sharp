CALLING SIDE

	//myDH = new SSC.ECDiffieHellmanCng();
            //myDH.KeyDerivationFunction = SSC.ECDiffieHellmanKeyDerivationFunction.Hash;
            //myDH.HashAlgorithm = SSC.CngAlgorithm.Sha384;
            BLAH myPass = new BLAH("PLEASE ENTER THE PASSPHRASE:", null); //myDH.PublicKey.ToXmlString());
            myPass.Shown += new EventHandler(this.OnPassFrmShow);
            DialogResult ret = myPass.ShowDialog(this);
            // MODAL FORM STOP - during this time the ECDiffieHellman exchange should have happened on the form's initialization
            // and finished up on the overridden Shown event.

            string resultingPassPhrase = null;
            if (ret == System.Windows.Forms.DialogResult.OK)
            {
                //UTF8Encoding myEncoder = new UTF8Encoding();
                //mySkein.Initialize(512);
                resultingPassPhrase = (string)myPass.Tag;
                //myEncoder.GetString(
                    //SkeinLib.ThreeFish.InvThreeFish512Bytes(
                    //    (byte[])myPass.Tag,
                    //    mySkein.ComputeHash(TEMPSECRETKEY), 
                    //    new byte[] { 0xff, 0xee, 0xdd }
                    //    )
                    //);

                myPass.Dispose();
            }
            else
            {
                myPass.Dispose();
                MessageBox.Show("YOU SUCK! NO SOUP FOR YOU!");
                Application.Exit();
            }


add event handler for called form Shown event
 private void OnPassFrmShow(Object sender, System.EventArgs e)
        {
            Form thePassForm = sender as Form;
            //TEMPSECRETKEY = myDH.DeriveKeyMaterial(SSC.ECDiffieHellmanCngPublicKey.FromXmlString((string)thePassForm.Tag));
            thePassForm.Tag = "";
        }



RESPONDING SIDE

edit default constructor with:

//private SSC.ECDiffieHellmanCng myDH = new SSC.ECDiffieHellmanCng();
        //private byte[] TEMPSECRETKEY = null;
        //private SkeinLib.Skein512Ex mySkein = new SkeinLib.Skein512Ex();

        public BLAH(string Caption, string foreignPubKeyXML)
        {
            InitializeComponent();
            this.DialogResult = System.Windows.Forms.DialogResult.Cancel;
            if (!string.IsNullOrWhiteSpace(Caption))
                this.Text = Caption;
            //myDH.KeyDerivationFunction = SSC.ECDiffieHellmanKeyDerivationFunction.Hash;
            //myDH.HashAlgorithm = SSC.CngAlgorithm.Sha384;
            //TEMPSECRETKEY = myDH.DeriveKeyMaterial(SSC.ECDiffieHellmanCngPublicKey.FromXmlString(foreignPubKeyXML));
            //this.Tag = myDH.PublicKey.ToXmlString();
        }


private void btnOk_Click(object sender, EventArgs e)
        {
            this.DialogResult = System.Windows.Forms.DialogResult.OK;
            if (true) //TEMPSECRETKEY != null)
            {   
                //UTF8Encoding myEncoder = new UTF8Encoding();
                //mySkein.Initialize(512);
                this.Tag = txtPassphrase.Text; //SkeinLib.ThreeFish.ThreeFish512Bytes(
                    //myEncoder.GetBytes(txtPassphrase.Text.Trim()),
                    //mySkein.ComputeHash(TEMPSECRETKEY), new byte[] { 0xff, 0xee, 0xdd });
            }
            this.Close();
        }